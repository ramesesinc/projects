<workunit>
    <invokers>
        <invoker folderid="/explorer/txn/bpls/util" action="init" 
                 caption="Build Delinquency Data" target="window" 
                 role="REPORT"/>
    </invokers>
    <code>

<![CDATA[

import com.rameses.gov.etracs.bpls.reports.ui.BPDelinquencyTask;
import com.rameses.rcp.common.*;
import com.rameses.rcp.annotations.*;
import com.rameses.osiris2.client.*;
import com.rameses.osiris2.reports.*;

class BuildBusinessDelinquencyController 
{
    @Binding
    def binding;
    
    @Service('BPReportDelinquencyService') 
    def svc;
            
    String title = 'Build Business Tax Delinquency';
    
    def task;
    
    def msg;
    def mode;
    def entity = [:];
    
    void init(){
        msg = 'Click Build to rebuild the business tax delinquency listing.';
        mode = 'init';
    }
   
    def oncomplete = {
        mode = 'init';
        task = null;
        msg = 'Delinquency listing has been successfully generated.';
        binding.refresh();
    }
    
    def updateStatus = {o ->
        msg = o; 
        binding.refresh('msg');
    }
    
    def oncancel = {
        init(); 
        binding.refresh(); 
    } 
    
       
    void doBuild() {
        getBarangays();
        
        task = new BPDelinquencyTask([
            svc          : svc,
            oncomplete   : oncomplete,
            oncancel     : oncancel, 
            updateStatus : updateStatus,
            params       : entity 
        ]);
        task.start();
        mode = 'building';
    }

    void doCancel(){
        task?.cancel(); 
        init();
    }

    def getBarangays(){ 
        if (entity.barangaylist == null) { 
            entity.barangaylist = svc.getBarangayList(); 
        } 
        return entity.barangaylist; 
    } 
} 
]]> 
        
    </code>
    <pages>
        <page template="com.rameses.gov.etracs.bpls.reports.ui.DelinquencyBuildPage"/>
    </pages>
</workunit>