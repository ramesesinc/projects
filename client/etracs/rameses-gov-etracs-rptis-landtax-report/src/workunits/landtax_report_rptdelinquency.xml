<workunit extends="rpt_wtemplates/ReportController.xml" >
    <invokers>
        <invoker folderid="/explorer/report/landtax" action="init" 
                 caption="Realty Tax Delinquency Listing" target="window" index="101" 
                 role="REPORT"/>
    </invokers>
    <code>
        
        <![CDATA[

import com.rameses.rcp.common.*;
import com.rameses.rcp.annotations.*;
import com.rameses.osiris2.client.*;
import com.rameses.osiris2.reports.*;

class RPTDelinquencyListingController extends com.rameses.gov.etracs.rpt.report.AsyncReportController
{
    @Service('RPTReportDelinquencyService') 
    def svc
    
    String title = 'Realty Tax Delinquency Listing';
    
    String reportName = 'com/rameses/gov/etracs/rpt/report/landtax/rptdelinquency.jasper';
    def data;
    
    def task;
    def msg;
    def sorttypes = [
        [code:'pin', name:' PIN'],
        [code:'taxpayer', name:' Taxpayer'],
        [code:'tdno', name:' TD Number'] 
    ];
    
    def periods = [
        [code:'AS_OF_BUILD',  name:' AS OF BUILD '], 
        [code:'AS_OF_YEAR', name:' AS OF YEAR '],  
        [code:'FOR_THE_YEAR', name:' FOR THE YEAR '] 
    ];    
    
    def initReport() { 
        def outcome = super.initReport(); 
        entity.period = periods[0]; 
        return outcome; 
    }
        
    void buildReportData(entity, asyncHandler){
        entity.reporttype = 'listing';
        svc.generateDelinquencyReport(entity, asyncHandler);
    }
    
    Map getParameters(){
        def map = [TITLE : 'Realty Tax Delinquency Listing'];
        map.BARANGAYNAME = (entity.barangay?.objid? entity.barangay.name: 'ALL'); 
        map.PERIODCODE = entity.period?.code; 
        
        if ( entity.period?.code.toString().matches('FOR_THE_YEAR|AS_OF_YEAR') ) { 
            map.PERIODNAME = entity.period.name.trim() + ' ' + entity.year; 
        } else { 
            map.PERIODNAME = entity.period.name.trim(); 
        } 
        return map; 
    } 
}


]]>        
    </code>
    
    <pages>
        <page template="com.rameses.gov.etracs.landtax.report.delinquency.RPTDeliquencyReportInitPage"/>
    </pages>
</workunit>