<?xml version="1.0" encoding="UTF-8"?>
<workunit>
    <invokers>
        <invoker type="rptledger:list:formActions" caption="Create Unposted Ledger" mnemonic="u" role="LANDTAX" index="20"/>
        
        <invoker type="formActions" action="_close" caption="Close" immediate="true" />
        <invoker type="formActions" action="create" caption="Create Ledger" role="LANDTAX"/>
    </invokers>
    <code>
        
<![CDATA[


import com.rameses.rcp.common.*;
import com.rameses.rcp.annotations.*;
import com.rameses.osiris2.client.*;
import com.rameses.osiris2.common.*;

class PostNoLedgerController
{
    @Binding 
    def binding;
    
    @Caller
    def caller;
    
    @Service('FAASService')
    def faasSvc;
    
    @Service('RPTLedgerService')
    def ledgerSvc;
    
    def request = [:];
    
    String title = 'Create Unposted Ledger';
    
    def create(){
        if (! MsgBox.confirm("Create ledger?"))
            return;
            
        def faas = faasSvc.getFaasByTdNo(request.tdno);
        if (!faas)
            throw new Exception('TD No. ' + request.tdno + ' is invalid or does not exist.');
            
        def ledger = null;
        try{
            ledger = ledgerSvc.getLedgerByFaasId( faas.objid )
        }
        catch(e){
            //
        }
        if (ledger)
            throw new Exception('Ledger for TD No. ' + request.tdno + ' has already been created.');
            
        ledgerSvc.postNewLedger(faas);
        ledger = ledgerSvc.getLedgerByFaasId( faas.objid )
        MsgBox.alert('Ledger successfully created.');
        
        request.tdno = null;
        return Inv.lookupOpener('rptledger:open', [entity:ledger]);
        
    }
    
}


]]>

    </code>
    <pages>
        <page template="com.rameses.gov.etracs.rptis.province.rptledger.ui.RemoteRPTLedgerRequestPage"/>
    </pages>
</workunit>
