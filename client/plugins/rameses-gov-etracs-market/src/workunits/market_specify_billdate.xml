<workunit>
    <invokers>
        <invoker type="market_specify_billdate" caption="Bill Date" target="popup" />
    </invokers>
    <code>
        <![CDATA[
        import com.rameses.common.*;
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.common.*;
        import com.rameses.functions.*;
        
        class SpecifyBillDate {
        
            def fromdate;
            def dateoption = "specify-date";
            def todate;
            int numdays;
            def handler;
            def df = new java.text.SimpleDateFormat("yyyy-MM-dd");
        
            
        
            def doOk() {
                def x = fromdate; 
                if( dateoption == "specify-date") {
                    x = todate;
                }
                else if( dateoption == "specify-month" ) {
                    
                }
                else {
                    if( numdays <= 0 ) throw new Exception("Numdays is required");
                    def d  = DateFunc.getDayAdd( fromdate, numdays );
                    x = df.format(d);
                }
                //calculate the bill date
                handler( x );
                return "_close";
            }
            
            def doCancel() {
                return "_close";
            }
        
        }
        ]]>
    </code>
    <pages>
        <page template="com.rameses.gov.etracs.market.views.SpecifyBillDate"/>
    </pages>    
</workunit>