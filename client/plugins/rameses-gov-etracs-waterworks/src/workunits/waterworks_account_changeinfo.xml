<workunit extends="com/rameses/treasury/common/templates/ChangeInfo.xml" schemaName="waterworks_changelog" 
    reftype="waterworks_account" >
    <invokers>
        <invoker type="waterworks_account:edit" target="popup" caption="Change Address" action="init" index="10"
                 keyfield="address"  datatype="local_address" preferredSize="550,100" captionWidth="60" />
        
        <invoker type="waterworks_account:edit" caption="Change Owner" action="init"  target="popup" index="11"
            keyfield="owner"  datatype="lookup" handler="entity:lookup" 
            expression="#{data.owner.name}" />            
        
        <invoker type="waterworks_account:edit" caption="Change Meter" action="init"  target="popup" index="12"
                 keyfield="meter"  datatype="lookup"  handler="waterworks_meter_wo_account:lookup" 
                 expression="#{data.meter.serialno}"/>
       
        <invoker type="waterworks_account:edit" action="init"  target="popup" index="13"
                 keyfield="units" datatype="integer" caption="Change No. of Units" />
        
        <invoker type="waterworks_account:edit" caption="Change Stubout Node" action="init"  target="popup" index="14"
            keyfield="stuboutnode" datatype="lookup" handler="waterworks_stuboutnode_unassigned:lookup" 
            expression="#{data.stuboutnode.indexno} Zone: #{data.stuboutnode.zone.code} Sector: #{data.stuboutnode.sector.code}"/>
        
    </invokers>
    
    <code>
        <![CDATA[
    
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import com.rameses.seti2.models.*;
        import java.text.*;
        import com.rameses.treasury.common.models.*;

        class AccountChangeInfoModel extends ChangeInfoModel {

            @PropertyChangeListener
            def flisten = [
                "data.stuboutnode": {o->
                    action = (!o?.objid ) ? "detach-node" : "change-node";
                    data.stuboutnodeid = o?.objid;
                },
                "data.meter" : { o->
                    action = (!o?.objid) ? "detach-meter" : "change-meter";
                    data.meterid = o?.objid; 
                }
            ];
        }

        ]]>
    </code>     
        
</workunit>
