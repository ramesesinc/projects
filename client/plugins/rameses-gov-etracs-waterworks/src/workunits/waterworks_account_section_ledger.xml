<workunit extends="com/rameses/seti2/templates/FormList.xml"
            schemaName="vw_waterworks_account_ledger" 
          cols="item.code,item.title,amount,amtpaid,balance,duedate,remarks" orderBy="duedate">
    <invokers>
        <invoker type="waterworks_account:section" caption="Ledger" index="2" 
                visibleWhen="#{mode=='read'}"
                action="init" target="popup"/>
        
        <invoker type="formActions" caption="Capture"  action="capture" />
    </invokers>
    <code>
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.seti2.models.*;

        class AccountLedgerModel extends com.rameses.seti2.models.CrudListModel {

            @Caller 
            def caller;
        
            void beforeQuery( def qry ) {
                qry.findBy = [parentid: caller.entity.objid];
            }
        
            void reload() {
                listHandler.reload();
            }
            
            def capture() {
                def h = {
                    reload();
                }
                Modal.show("waterworks_account_ledger:capture",[handler:h, entity:caller.entity]);
            }
                
        
        }
    </code>
</workunit>