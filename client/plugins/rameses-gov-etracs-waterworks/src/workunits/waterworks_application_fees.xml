<workunit>
    <invokers>
        <invoker type="waterworks_application_fee:list"  
                 caption="Fees" action="init"/>
    </invokers>
    <code>
         <![CDATA[
            import com.rameses.rcp.common.*
            import com.rameses.rcp.annotations.*
            import com.rameses.osiris2.client.*
            import com.rameses.osiris2.common.*
            import com.rameses.rulemgmt.constraint.*;
            import com.rameses.rulemgmt.*;
            import java.rmi.server.*;
            
            class FeeList  {
            
                @Service("QueryService")
                def queryService;
            
                def entity;
                def total;
                def feeList;
            
                void init() {
                    def  m = [_schemaname:'waterworks_application_fee'];
                    m.findBy = [parentid: entity.objid];
                    feeList = queryService.getList(m);
                    total = feeList.sum{ it.balance };
                }
            
                def feeListModel = [
                    fetchList: {o->
                        return feeList;
                    }
                ] as BasicListModel;
                
                void refresh() {
                    feeListModel.reload();
                }
            }
        ]]>  
    </code>    
    <pages>
        <page template="com.rameses.gov.etracs.waterworks.views.ApplicationFeeList" />
    </pages>    
</workunit>
