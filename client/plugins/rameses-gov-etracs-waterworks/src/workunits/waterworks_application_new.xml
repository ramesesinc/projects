<workunit  schemaName="waterworks_application">
    <invokers>
        <invoker type="waterworks_application:create"
                 formTitle="New Water Application" 
                 formId="waterworks_new"
                 action="start" />
    </invokers>
    <code>
        import com.rameses.rcp.annotations.*;
        import com.rameses.seti2.models.*;
        class WaterworksNewApplication extends CrudPageFlowModel { 
        
            @Script('RevenueRules')
            def ruleScript; 
        
            void afterCreate() { 
                entity.account = [address:[:]]; 
            }
        
            void computeFee() { 
                def m = [txntype: getSchemaName()]; 
                def result = ruleScript.execute( m );
                entity.items = result.items; 
                entity.total = result.total;
            } 
        }
    </code>
    <pageflow>
        <start>
            <transition to="initial"/>
        </start>
        <page name="initial" title="Waterworks Application Initial Page">
            <transition to="compute-fees" caption="Next" action="computeFee"/>
        </page>
        <page name="compute-fees" title="Compute Fees">
            <transition to="initial" caption="Back" />
            <transition to="end" caption="Submit" confirm="You are about to save the record. Proceed?" 
                        action="saveCreate"/>
        </page>
        <end/>
    </pageflow>        
    <pages>
        <page name="initial" template="com.rameses.gov.etracs.waterworks.views.WaterworksApplicationInitialPage"/>
        <page name="compute-fees" template="com.rameses.gov.etracs.waterworks.views.WaterworksApplicationComputeFeePage"/>
    </pages>
      
</workunit>
