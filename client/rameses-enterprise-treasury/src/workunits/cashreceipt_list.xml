<workunit extends="wtemplates/ListController.xml" 
          serviceName="CashReceiptQueryService" 
          entityName="cashreceiptinfo" 
          allowCreate="false">
    
    <invokers>
        <invoker folderid="/explorer/txn/treasury" caption="Cash Receipts Query" 
                 role="SHARED" permission="cashreceipt.query" index="11"/>
        
        <invoker type="formActions" caption="Revert Void" action="revertVoid" 
                 role="ADMIN" permission="cashreceiptvoid.revert" 
                 visibleWhen="#{allowRevertVoid==true}"/>
   </invokers>
   
    <code>
    <![CDATA[
import com.rameses.rcp.common.*;
import com.rameses.rcp.annotations.*;
import com.rameses.osiris2.client.*;
import com.rameses.osiris2.common.*;
import com.rameses.osiris2.common.* 

class CashReceiptQueryModel extends DefaultListController {
  
    @Service("CashReceiptVoidService")
    def voidSvc;
  
    boolean isAllowRevertVoid() { 
        if ( !selectedEntity ) return false; 
        if ( selectedEntity.remitted==true || selectedEntity.remitted==1 ) return false; 
        if ( selectedEntity.voided==true || selectedEntity.voided==1 ) return true; 
        
        return false; 
    } 
    
    def revertVoid() {
        def params = [ receipt: selectedEntity ]; 
        params.handler = { o-> 
            selectedEntity.voided = 0;
            binding?.refresh();
        } 
        return InvokerUtil.lookupOpener( "cashreceiptvoid:revert", params );  
    }   
    
    def sortType;
    def sortTypes = ['ASC','DESC']; 
    
    def sortField; 
    def sortFields = [
        [name: 'receiptno', caption: "Receipt No."], 
        [name: 'receiptdate', caption: "Receipt Date"],
        [name: 'paidby', caption: "Payer"] 
    ];  
    
    protected void beforeFetchList(Map params) {
        if ( sortField?.name ) { 
            params.sortfield = sortField.name; 
            params.sorttype = sortType; 
        } 
    }
}
    ]]>
    </code>      
    
    <pages>
        <page name="queryform" template="com.rameses.enterprise.treasury.views.CashReceiptQueryFilter"/>
    </pages>        
</workunit>