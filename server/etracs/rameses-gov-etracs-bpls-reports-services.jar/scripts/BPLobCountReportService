import com.rameses.annotations.*;
import com.rameses.common.*;

class BPLobCountReportService
{
	
	@Service('NumberService')
	def numSvc;
	
	@ActiveDB("bpreport")
	def em

	@ProxyMethod
	public def getReport( params ) { 
		params.filter = '';

		def states = []; 
		if ( params.state_info ) states << "INFO"; 
		if ( params.state_assessment ) states << "ASSESSMENT"; 
		if ( params.state_payment ) states << "PAYMENT";
		if ( params.state_release ) states << "RELEASE";
		if ( params.state_completed ) states << "COMPLETED";
		if ( states ) { 
			params.filter += " AND a.state IN ('" + states.join("','") + "')"; 
		} else { 
			throw new Exception('Please select at least one state of transaction');
		} 

		if ( params.barangay?.objid ) { 
			params.barangayid = params.barangay.objid; 
			params.filter += ''' AND baddr.barangay_objid=$P{barangayid} ''';
		} 
		if ( params.classification?.objid ) { 
			params.classificationid = params.classification.objid; 
			params.filter += ''' AND lob.classification_objid=$P{classificationid} '''; 
		} 
		if ( params.permittype?.objid ) { 
			params.permittypeid = params.permittype.objid; 
			params.filter += ''' AND b.permittype=$P{permittypeid} '''; 	
		} 

		def list = em.getLOBCountList( params );
		if ( !list ) throw new Exception('No records found.');

		return list; 	
	}

}