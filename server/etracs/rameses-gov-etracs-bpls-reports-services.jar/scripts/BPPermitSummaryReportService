import com.rameses.annotations.*;
import com.rameses.common.*;

class BPPermitSummaryReportService
{
	
	@ActiveDB("bpreport")
	def em

	@Service("DateService")
	def dtSvc 

	@ProxyMethod
	public def getReport(params) { 
		if ( !params.permittype?.objid ) throw new Exception('permittype parameter is required'); 
		if ( !params.year ) throw new Exception('year parameter is required');

		params.permittypeid = params.permittype.objid; 
		params.filter = ''' AND b.permittype=$P{permittypeid} '''; 	

		def list = em.getBusinessPermitSummary( params );
		if( ! list ) throw new Exception('No records found.');

		list.each { x-> 
			x.newcount = (x.newcount) ? (Integer)x.newcount : 0;
			x.renewcount =  (x.renewcount) ? (Integer)x.renewcount : 0;
			x.retirecount = (x.retirecount)? (Integer)x.retirecount : 0;
			if ( x.iqtr ) x.sqtr = 'Q'+x.iqtr; 
		} 
		return list;
	}

}