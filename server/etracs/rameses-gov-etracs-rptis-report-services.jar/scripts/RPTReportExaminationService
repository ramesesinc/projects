import com.rameses.annotations.*
import com.rameses.common.*;
import com.rameses.services.extended.*;
import java.rmi.server.UID

class RPTReportExaminationService
{
	@Env 
	def env 

    @ActiveDB('rptreport_examination')
    def em

    @Service('RPTUtil')
    def util 


    @Async
	@ProxyMethod
	public def generateReport( params )  {
		params.lguid = params.lgu.objid 
		params.period = util.buildPeriod(params)
		util.buildStartEndDateFilter(params)
		
		def list = em.getExaminationFindings(params)
		if (!list) throw new Exception('Records not found.')

		list.each{
			if (it.refnoprefix){
				it.refno = it.refnoprefix + it.refno 
			}
		}

		def parameters = [:] 
		parameters.TITLE = 'PROPERTY EXAMINATION AND AUDIT REPORT'
		parameters.PERIOD = params.period
		parameters.ORGCLASS = env.ORGCLASS 
		return [reportdata:list, parameters:parameters]
	}

}
