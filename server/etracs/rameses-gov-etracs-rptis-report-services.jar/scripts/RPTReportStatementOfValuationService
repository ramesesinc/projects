import com.rameses.annotations.*
import com.rameses.common.*;
import com.rameses.services.extended.*;

class RPTReportStatementOfValuationService
{
	@Env 
	def env 

    @ActiveDB('rptreport_statement_of_valuation')
    def em

    @Service('Var')
    def var 

    @Service('PropertyClassificationService')
    def pcSvc 

    @Service('ExemptionTypeService')
    def etSvc

    @Service('RPTUtil')
    def util

    @Service('ReportParameterService')
    def paramSvc 

    @Service('DateService')
    def dtSvc 


    @Async
	@ProxyMethod
	public Map buildReport( params ) {
		util.required('LGU', params.lgu)
		util.required('Month', params.month)

		params.lguid = params.lgu.objid 
		params.monthid = params.month.index 
		
		def p = [
			TITLE 		: 'STATEMENT OF VALUATION ' + params.month.caption + ' ' + params.year ,
			FORLGUNAME  : (params.lgu ? params.lgu.fullname : (env.ORGCLASS + ' OF ' + env.ORGNAME)),
		]

		def items = em.getList(params).each{ 
			it.title = it.title.toUpperCase()
			if (it.isitem == 1) it.title = '     ' + it.title 
		}

		return [
			parameters  : p, 
			reportdata  : items,
		]
	}
}
