import com.rameses.annotations.*; 

class RPTElectronicReceiptInterceptor 
{

    @Service('RPTReceiptService')
    def receiptSvc 

    @DataContext('rptbill')
    def em_rptbill


    @After(pattern="OnlineElectronicReceiptService.post", eval="#{args[0].txntype=='rptcol'}")
    public void postRPTReceipt(evt){
        def rct = evt.result 
        def po = rct.po 
        rct.billid = po.refid 
        def bill = em_rptbill.find([objid:rct.billid]).first()
        rct.rptitems = receiptSvc.getItemsForPayment(bill)
        rct.txntype = 'eor'
        receiptSvc.createReceipt(rct)
    }
}
