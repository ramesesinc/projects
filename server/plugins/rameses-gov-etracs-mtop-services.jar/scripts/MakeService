import com.rameses.annotations.*;
import com.rameses.util.*;
import java.rmi.server.*;
import com.rameses.common.*;
import com.rameses.services.extended.*;

class MakeService extends ActiveCrudListService {

	@ActiveDB(value="mtopmake", em="mtop" )
	def em;

	@ProxyMethod
	public def getColumns( def o ) {
		return [
			[name:'code', caption:'Code' ],
			[name:'name', caption:'Name' ],
			[name:'state', caption:'State' ],
		];
	}	

	protected void beforeCreate(def entity){
		em.deleteModels( entity )
	}

	protected void afterCreate(def entity){
		entity.models.each {
			it.makeid = entity.objid 
			it.state = 'APPROVED'  
 			em.create(it, 'mtopmodel') 
		}
	}
	
	protected void afterRemoveEntity(def entity){
		em.deleteModels( entity )
	}

	protected void afterOpen(def entity){
		entity.models = em.getModels( entity )
	}

	protected void beforeUpdate(def entity){
		em.deleteModels( entity ) 
	}

	protected void afterUpdate(def entity){
		entity.models.each {
			it.makeid = entity.objid 
			it.state = 'APPROVED'  
 			em.create(it, 'mtopmodel')  
		}
	}
	

}
