import com.rameses.annotations.*; 

class OboApplicationInterceptor { 

	@Service("WorkflowTaskService")
	def wfSvc;

	@Service("DateService")
	def dateSvc;

	@Service("SequenceService")
	def seqSvc;



	@Before(pattern="PersistenceService.create", eval="#{args[0]._schemaname == 'obo_application' }") 
	public void beforeStartWorkflow( def evt ) {
		def o = evt.args[0];		
		o.appno = "OB" + seqSvc.getNextFormattedSeries( 'OBOAPP');
		o.appdate = dateSvc.getServerDate();
	} 

	@After(pattern="PersistenceService.create", eval="#{args[0]._schemaname == 'obo_application' }") 
	public void afterCreateStartWorkflow( def evt ) {
		def o = evt.args[0];
		o.processname = 'obo_application'; 
		o.refid = o.objid;
		wfSvc.start(o);
	} 


} 