import com.rameses.annotations.*;

class PoliceClearancePersistenceInterceptor {
	
	@Service("SequenceService")
	def seqSvc;

	@Service("DateService")
	def dateSvc;

	@Before(pattern="PersistenceService.create", eval="#{args[0]._schemaname == 'policeclearance_application'}")
	public void beforeCreate(def evt) {
		def v  = evt.args[0];
		v.appno = seqSvc.getNextControlNo( "P[ORG][yyyyMM]%05d", [] );
		v.state = 'PAYMENT';
		v.appdate = dateSvc.getBasicServerDate();
	}

	@After(pattern="PersistenceService.(create|read)", eval="#{args[0]._schemaname == 'policeclearance_application'}")
	public void afterCreate(def evt) {
		def r = evt.result;
		r.barcode = '51011:'+ r.appno;
	}


}