<schema adapter="waterworks">
	<element name="wacct" tablename="waterworks_account">
		<field name="objid" primary="true"  prefix="WACC"/>
		<field name="state"  visible="false" defaultValue="ACTIVE"/>
		<field name="dtstarted" required="false" indexed="true" type="date" caption="Date Started"/>
		<field name="acctno" required="true" indexed="true" caption="Acct No" searchable="true"/>
		<field name="acctname" required="true" indexed="true" caption="Acct Name" searchable="true"/>

		<field name="applicationid" required="false"/>

		<field name="owner_objid" visible="false" caption="Owner ID"/>
		<field name="owner_name" indexed="true" caption="Owner Name"/>
		<field name="address_type" caption="Address Type" visible="false"/>
		<field name="address_text" caption="Address"/>
		<field name="address_barangay_objid" required="true" caption="Barangay ID"/>
		<field name="address_barangay_name" required="true" caption="Barangay"/>
		<field name="address_city" caption="City"/>
		<field name="address_province"  caption="Province"/>
		<field name="address_municipality"  caption="Municipality"/>
		<field name="address_unitno"  caption="Unit No"/>
		<field name="address_street"  caption="Street"/>
		<field name="address_subdivision"  caption="Subdivision"/>
		<field name="address_bldgno" caption="Building No"/>
		<field name="address_bldgname"  caption="Building Name"/>
		<field name="address_pin" caption="PIN"/>
		
		<complex name="sector" ref="waterworks_sector" jointype="many-to-one"  required="true" 
			includefields="objid,code">
			<key field="sectorid" target="objid"/> 
		</complex> 
		<complex name="zone" ref="waterworks_sector_zone" jointype="many-to-one"  required="true" 
			includefields="objid,code,reader.assignee.objid,reader.assignee.name">
			<key field="zoneid" target="objid"/> 
		</complex> 

		<complex name="meter" ref="waterworks_meter" jointype="many-to-one"  required="true" 
			includefields="objid,serialno,brand,capacity">
			<key field="meterid" target="objid"/>
		</complex>
		<complex name="metersize" ref="waterworks_metersize" jointype="many-to-one"  required="true" 
			includefields="objid,title">
			<key field="metersizeid" target="objid"/> 
		</complex> 

		<complex name="classification" ref="waterworks_classification" jointype="many-to-one" required="true">
			<key field="classificationid" target="objid"/>
		</complex>	

		<!-- Dates -->
		<field name="lastdateread" required="false" indexed="true" caption="Last Date Read"/>
		<field name="lastdatepaid" required="false" indexed="true" caption="Last Date Paid"/>

		<complex name="stubout" ref="waterworks_stubout" jointype="many-to-one" required="false" 
			includefields="objid,code"> 
			<key field="stuboutid" target="objid"/>
		</complex>  
		<complex name="stuboutnode" ref="waterworks_stubout_node" jointype="many-to-one" required="false" 
			includefields="objid,indexno">
			<key field="stuboutnodeid" target="objid"/> 
		</complex>

		<field name="currentreading" required="false" caption="Last Reading" type="integer"/>

		<complex name="billingcycle" ref="waterworks_billing_cycle" jointype="many-to-one" required="false" 
			includefields="objid,year,month,fromperiod,toperiod,duedate,billdate,readingdate,disconnectiondate,monthname">
			<key field="billingcycleid" target="objid"/> 
		</complex>

		<field name="barcode" expr="CONCAT('51030:',acctno)"/>
		<field name="lastbilldate" type="date"/>
	</element>

</schema>