import com.rameses.annotations.*;

class WaterworksAccountService {
	
	@DataContext('waterworks_account_ledger')
	def ledger; 

	@DataContext('waterworks_account_consumption')
	def consumption; 

	@ProxyMethod
	public def postReading( def o ) {
		if(!o.duedate) throw new Exception("Duedate is required");
		o.readingmethod = 'CAPTURE';
		o.txntype = 'WFEE';
		o.rate = o.amount;
		if(o.postledger == true ) {
			def i = [:];
			i.parentid = o.account.objid;
			i.year = o.year;
			i.month = o.month;
			i.duedate = o.duedate;
			i.txntype = 'WFEE';
			i.item = o.item;
			i.remarks = o.remarks;
			i.amount = o.amount;
			i.amtpaid = 0.0;
			i.surcharge = 0.0;
			i.interest = 0.0;
			i = ledger.create(i);
			o.ledgerid = i.objid;
		}
		consumption.create( o );
	}

	@ProxyMethod
	public def postLedger( def o ) {
		o.txntype = 'WFEE';
		if(o.postledger == true ) {
			o.parentid = o.account.objid;
			ledger.create(o);
		}
	}


}