import com.rameses.annotations.*;

class WaterworksAccountService {
	
	@DataContext('waterworks_account_consumption')
	def consumption; 

	@DataContext('waterworks_account')
	def acct; 


	@ProxyMethod
	public def postReading( def o ) {
		consumption.create( o );

		//update the maximum in the acct code.
		def z = consumption.select("c:{MAX(billingcycleid)}").find( [acctid:o.account.objid] ).val();
		def bc = consumption.find([billingcycleid: z]).first();

		acct.find( [objid: o.account.objid] ).update( [billingcycleid: z, currentreading: bc.reading, lastdateread: bc.billingcycle.readingdate,billdate:bc.billingcycle.billdate] );
	}



}