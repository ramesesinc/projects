import com.rameses.annotations.*;

class WaterworksPaymentOrderInterceptor {
	
	@Service('WaterworksCashReceiptService') 
	def cashReceiptSvc; 

	@Env
	def env; 

	@Before( pattern="PaymentOrderService.open", eval="#{args[0].txnid.startsWith('WA')}" )
	public void beforeOpen( evt ) {
		def params = evt.args[0]; 
		def txnid = params.txnid; 
		def p = cashReceiptSvc.getBilling([ refno: txnid ]); 

		//this is needed for posting back to the server during CashReceiptService.post
		p.info = [applicationid: p.applicationid, txntype:'waterworks_application']
		env.paymentorder = [info:p, txntype:'waterworks_application',txnid:p.applicationid,refid:p.applicationid];  
	}

	

}	