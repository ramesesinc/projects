import com.rameses.annotations.*
import com.rameses.common.*
import java.rmi.server.UID;
import com.rameses.util.*;
import com.rameses.io.*;

class EntityService 
{
	@DataContext("entity")
	def	em; 

	@Service('PersistenceService')
	def persistenceSvc;	

	@ActiveDB('entity')
	def entityEm 


	@ProxyMethod
	public def open( o ) { 
		def type = em.select('type').find([ objid: o.objid ]).val(); 
		if (!type || type == 'null') type = o.type 
		o._schemaname = 'entity' + type.toString().toLowerCase();
		println 'o._schemaname  -> ' + o._schemaname 
		return persistenceSvc.read( o ); 
	} 

	@ProxyMethod
	public def save( o ) { 
		def entity = entityEm.findEntity(o)
		if (entity){
			if ('individual'.equalsIgnoreCase(o.type)){
				def individual = entityEm.findIndividual(o)	
				if (!individual) entityEm.insertIndividual(o)
			}
			else if ('juridical'.equalsIgnoreCase(o.type)){
				def juridical = entityEm.findJuridical(o)	
				if (!juridical) entityEm.insertJuridical(o)
			}
			else if ('multiple'.equalsIgnoreCase(o.type)){
				def multiple = entityEm.findMultiple(o)	
				if (!multiple) entityEm.insertMultiple(o)
			}
		}
		o._schemaname = 'entity' + o.type.toString().toLowerCase(); 
		return persistenceSvc.save( o ); 
	} 

	@ProxyMethod 
	public def getPhoto( o ) {
		return [:]; 
	}

	@ProxyMethod 
	public def getTypes() {
		return []; 
	}
}
