import com.rameses.annotations.*;

class LiquidationDefaultInterceptor {

	@DataContext("liquidation")
	def liq_db;

	@DataContext("liquidation_fund")
	def liqf_db;

	@DataContext("liquidation_noncashpayment")
	def liqnc_db;

	@DataContext("remittance_fund")
	def remf_db;

	@DataContext("remittance")
	def rem_db;

	@Before( pattern="PersistenceService.removeEntity", eval="#{args[0]._schemaname == 'liquidation'}" )
	public void beforeDelete( evt ) {
		def params = evt.args[0]; 
		def m = [ liquidationid: params.objid ];
		liqf_db.unbindNonCashPayments( m ); 
		liqf_db.unbindRemittanceFunds( m ); 

		rem_db.find( m ).update([ liquidationid: '{NULL}' ]);
		
		liqf_db.find( m ).delete(); 
		liqnc_db.find( m ).delete(); 
	} 


	@After( pattern="LiquidationService.post" )
	public void afterPost( evt ) {
		def result = evt.result; 
		def m = [ liquidationid: result.objid ]; 
		liq_db.postJev( m ); 
		liq_db.postJevItem( m ); 
		liq_db.postJevItemForBankAccount( m ); 
		liq_db.postJevItemForRevenue( m ); 
	} 
}