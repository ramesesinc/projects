  

  <%

    def service = SERVICE.lookup("ElectronicReceiptService", "etracs");
    def cache = SERVICE.lookup("CacheService", "etracs");
    def idx = PARAMS.Particulars.indexOf('PMO:');
    def key = PARAMS.Particulars.substring(idx, idx + 10);
    def pmo = cache.get([key:key]);

    def eor = [:];
      eor.objid = key;
      eor.txnrefid =key;
      eor.txnreftype = 'pmo';
      eor.txntype = pmo?.txntype.objid;
      eor.refno = PARAMS.EppRefNo;
      eor.refdate = pmo.refdate;
      eor.amount = PARAMS.Amount;
      eor.particulars = PARAMS.Particulars;
      eor.partner = [objid : 'lbp'];

      service.createPayment(eor);
      def receipt = service.post(pmo, eor);


%>

<script>
\$put("receiptprint", new function(){

    this.print = function (){
      var params = {
        header : "${PROJECT['lgu.name']}",
        paymenttype : "${receipt.paymentitems[0].particulars}",
        receiptno : "${receipt.receiptno}",
        receiptdate : "${receipt.receiptdate}",
        txnno : "${receipt.paymentitems[0].refno}",
        paidby : "${receipt.paidby}",
        amount : "Php${receipt.amount}",
        particulars : "${receipt.particulars}"


      };
      window.console.log(params);
      alert(params);
      alert(window.handler);
      alert(document.handler);
      WebViewUtil.print(params, "receipt");

    }


}); 
</script> 

<div id="wrapper" > 
    <div id="content">
        <div class="container">
          <div class="bg-white">
            <div class="bill-main-panel">
              <div class="row">
                <div class="col-md-12"> 
                  <div class="l-name">
                    <p class="label-name">Payment Successful</p>
                    <p class="label-address">Your payment has been processed. Here are the details of this transaction for your reference</p>
                  </div>    
                </div>
                <div class="bill-second-panel">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="label-top">
                        <p class="label-title">Receipt No.</p>
                        <p>: ${receipt.receiptno}</p>
                      </div>
                      <div class="label-top">
                        <p class="label-title">Receipt Date</p>
                        <p>: ${receipt.receiptdate}</p>
                      </div> 
                      <div class="label-top">
                        <p class="label-title">Paid By</p>
                        <p>: ${receipt.paidby}</p>
                      </div> 
                      <div class="label-top">
                        <p class="label-title">Txn No.</p>
                        <p>: ${receipt.paymentitems[0].refno}</p>
                      </div>
                      <div class="label-top">
                        <p class="label-title">Particulars:</p>
                        <p> ${receipt.paymentitems[0].particulars}</p>
                      </div>
                    </div>  
                  </div>
                </div> 
              </div>
            </div>
        </div> 
      <div class="col-md-3">
        <form method="post" action="/index">
          <input type="submit" class="thumbnail" value="New Transaction"/>
        </form>
      </div>
      <div class="col-md-3">
        <button type="submit" class="thumbnail" r:context="receiptprint" r:name="print">Print Receipt</button>
      </div>
    </div>
  </div>
</div>





